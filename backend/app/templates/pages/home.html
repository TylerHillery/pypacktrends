{% from "fragments/package_search_input.html" import package_search_input %}

<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="initial-scale=1, width=device-width" />
  <meta name="color-scheme" content="light" />
  <script src="https://unpkg.com/htmx.org@2.0.3"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <script>
    function submitPackageSearchForm(packageName) {
      document.getElementById('package-search-input').value = packageName;
      htmx.trigger('#package-search-form', 'submit');
    }
  </script>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üêç</text></svg>">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.conditional.min.css" />

  <style>
    [data-theme="light"],
    :root:not([data-theme="dark"]) {
      --pico-primary-background: var(--pico-form-element-border-color);
      --pico-border-width: 0.12rem;
    }

    #package-search-form {
      position: relative;
      margin-bottom: 1rem;
    }

    #package-search-input {
      border-radius: 0rem;
      margin-bottom: 0;
      box-shadow: none;
      height: 2.25rem;
      padding-left: 2.5rem;
    }

    .package-search-results {
      position: absolute;
      width: 100%;
      padding: 0;
      background: var(--pico-form-element-background-color);
      border: var(--pico-border-width) solid var(--pico-form-element-active-border-color);
      border-top: none;
      box-shadow: var(--pico-box-shadow);
      max-height: 300px;
      overflow-y: auto;
      z-index: 1002;
    }

    .search-item {
      cursor: pointer;
      display: flex;
      flex-direction: column;
      padding: 0 0.5rem;
      font-size: 0.9rem;
    }

    .search-item:hover,
    .search-item:focus {
      background-color: var(--pico-muted-border-color);
    }

    .search-item:focus {
      outline: none;
    }

    #package-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      width: 100%;
      padding: 0;
    }

    .package-item {
      min-width: fit-content;
      height: 30px;
      display: flex;
      align-items: center;
      padding: 0.5rem 2rem 0.5rem 0.75rem;
      border: 0.17rem solid var(--pico-form-element-active-border-color);
      border-radius: var(--pico-border-radius);
      position: relative;
    }

    .delete-x {
      position: absolute;
      right: 8px;
      top: 3px;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
    }

    .delete-x:hover {
      color: red;
    }

    #vis {
      width: 100%;
    }


  </style>
  <title>PyPack Trends</title>
</head>

<body class="container">
  <div class="pico">
    <header>
      <h3>üêç PyPack Trends</h3>
    </header>
    <div>
      <p>Compare package download counts over time</p>
    </div>

    <form id="package-search-form" hx-trigger="submit" hx-post="/package-list" hx-target="#package-list"
      hx-swap="beforeend" hx-on::after-request="
          console.log('Triggering Event:', event.detail.requestConfig);
          if (event.detail.requestConfig.triggeringEvent.type === 'submit' && 
              event.detail.requestConfig.elt.id === 'package-search-form') {
            htmx.trigger('#packages-graph', 'dataRefresh')
          }">
      <div id="package-search-container" hx-trigger="submit from:#package-search-form" hx-target="this"
        hx-get="/package-search-input" hx-include="#package-search-form" hx-swap="innerHTML">
        {{ package_search_input() }}
      </div>
    </form>
    <div hx-trigger="load" hx-get="/package-list" hx-target="#package-list" hx-swap="innerHTML">
      <ul id="package-list" class="package-list">
      </ul>
    </div>
  </div>


  <div id="packages-graph" hx-trigger="load, dataRefresh from:body" hx-get="/packages-graph" hx-swap="innerHTML">
  </div>

  <div class="pico">
    <hr />
    <footer>
      <h4>About</h4>
      <p>
        This site was created by
        <a href="https://github.com/tylerhillery">Tyler Hillery</a>
      </p>
    </footer>
  </div>

</body>

</html>